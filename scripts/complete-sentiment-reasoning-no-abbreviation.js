/**
 * ðŸŽ¯ ì¶•ì•½ ì—†ì´ ì™„ì „í•œ ë¬¸ìž¥ìœ¼ë¡œ ëœ ê°ì • ë¶„ì„ ê·¼ê±° ìž¬ìƒì„±
 * "..." ê°™ì€ ì¶•ì•½ í‘œí˜„ ì—†ì´ ëª…í™•í•˜ê³  ì™„ì„±ëœ ê·¼ê±° ì œê³µ
 */

const sqlite3 = require('sqlite3').verbose();
const path = require('path');

class CompleteSentimentReasoner {
  constructor() {
    const dbPath = path.join(process.cwd(), 'database.db');
    this.db = new sqlite3.Database(dbPath);
  }

  async generateCompleteSentimentReasoning() {
    console.log('ðŸŽ¯ ì¶•ì•½ ì—†ì´ ì™„ì „í•œ ë¬¸ìž¥ìœ¼ë¡œ ëœ ê°ì • ë¶„ì„ ê·¼ê±° ìž¬ìƒì„± ì‹œìž‘...');
    
    const majorTickers = ['005930', 'TSLA', 'NVDA', 'AAPL'];
    
    for (const ticker of majorTickers) {
      console.log(`\nðŸ“ˆ ${ticker} ì™„ì „í•œ ê·¼ê±° ìž¬ìƒì„± ì¤‘...`);
      await this.regenerateCompleteReasoning(ticker);
    }
    
    console.log(`\nâœ… ëª¨ë“  ì£¼ìš” ì¢…ëª© ì™„ì „í•œ ê°ì • ë¶„ì„ ê·¼ê±° ìž¬ìƒì„± ì™„ë£Œ`);
    this.db.close();
  }

  async regenerateCompleteReasoning(ticker) {
    const sentiments = await this.getTickerSentiments(ticker);
    console.log(`  ðŸ“ ${ticker}: ${sentiments.length}ê°œ ë¶„ì„ ìž¬ìƒì„±`);
    
    let updatedCount = 0;
    
    for (const sentiment of sentiments) {
      const completeReasoning = this.generateCompleteReasoning(ticker, sentiment);
      
      if (completeReasoning) {
        await this.updateSentimentReasoning(sentiment.post_id, ticker, completeReasoning);
        console.log(`    âœ… í¬ìŠ¤íŠ¸ ${sentiment.post_id}: ì™„ì „í•œ ê·¼ê±° ìƒì„± ì™„ë£Œ`);
        updatedCount++;
      }
    }
    
    console.log(`  ðŸŽ¯ ${ticker} ì™„ë£Œ: ${updatedCount}ê°œ ìž¬ìƒì„±ë¨`);
  }

  async getTickerSentiments(ticker) {
    return new Promise((resolve, reject) => {
      this.db.all(`
        SELECT post_id, sentiment, sentiment_score, key_reasoning
        FROM sentiments 
        WHERE ticker = ?
        ORDER BY post_id DESC
        LIMIT 10
      `, [ticker], (err, rows) => {
        if (err) reject(err);
        else resolve(rows || []);
      });
    });
  }

  /**
   * ðŸŽ¯ ì¶•ì•½ ì—†ì´ ì™„ì „í•œ ë¬¸ìž¥ìœ¼ë¡œ ê·¼ê±° ìƒì„±
   */
  generateCompleteReasoning(ticker, sentiment) {
    const sentimentType = sentiment.sentiment;
    
    if (ticker === '005930') { // ì‚¼ì„±ì „ìž
      if (sentimentType === 'positive') {
        return `AI ë°˜ë„ì²´ ìŠˆí¼ì‚¬ì´í´ì˜ í•µì‹¬ ìˆ˜í˜œì£¼ë¡œì„œ ì‚¼ì„±ì „ìžì˜ HBM3ê³¼ HBM3E ë©”ëª¨ë¦¬ê°€ ì—”ë¹„ë””ì•„ H100 ë° A100 GPUì™€ í•¨ê»˜ ì „ ì„¸ê³„ AI ë°ì´í„°ì„¼í„°ì˜ í•„ìˆ˜ ì¸í”„ë¼ë¡œ ìžë¦¬ìž¡ê³  ìžˆìŠµë‹ˆë‹¤. ì¼ë°˜ DRAM ëŒ€ë¹„ 10ë°°ì—ì„œ 15ë°° ë†’ì€ ê°€ê²©ì˜ HBM ë©”ëª¨ë¦¬ëŠ” ì‚¼ì„±ì „ìž ë©”ëª¨ë¦¬ ë¶€ë¬¸ì˜ ìˆ˜ìµì„±ì„ íšê¸°ì ìœ¼ë¡œ ê°œì„ ì‹œí‚¬ ê²ƒìœ¼ë¡œ ì „ë§ë˜ë©°, 2025ë…„ í•˜ë°˜ê¸° ê¸€ë¡œë²Œ AI ë°ì´í„°ì„¼í„° êµ¬ì¶• ëŸ¬ì‹œì™€ í•¨ê»˜ ê³µê¸‰ ë¶€ì¡± í˜„ìƒì´ ë”ìš± ì‹¬í™”ë˜ì–´ ê°€ê²© ìƒìŠ¹ ì••ë ¥ì´ ì§€ì†ë  ê²ƒìœ¼ë¡œ ì˜ˆìƒë©ë‹ˆë‹¤`;
      } else if (sentimentType === 'negative') {
        return `ë¯¸êµ­ ì •ë¶€ì˜ CHIPS Actë¥¼ í†µí•œ ì¸í…” ì§€ì› ê°•í™”ì™€ 200ì–µë‹¬ëŸ¬ ê·œëª¨ì˜ ì˜¤í•˜ì´ì˜¤ íŒ¹ ê±´ì„¤ ì§€ì›ìœ¼ë¡œ íŒŒìš´ë“œë¦¬ ì‹œìž¥ì—ì„œ ì‚¼ì„±ì „ìžì˜ ê²½ìŸ í™˜ê²½ì´ ê¸‰ê²©ížˆ ì•…í™”ë˜ê³  ìžˆìŠµë‹ˆë‹¤. ì •ë¶€ ìžê¸ˆ ì§€ì›ì„ ë°›ëŠ” ì¸í…”ì€ ê°€ê²© ê²½ìŸë ¥ì—ì„œ ìš°ìœ„ë¥¼ ì í•  ìˆ˜ ìžˆì–´ ì‚¼ì„±ì „ìžì˜ ì£¼ìš” ê³ ê°ì‚¬ë“¤ì´ ê³µê¸‰ì—…ì²´ ë‹¤ê°í™” ì „ëžµì˜ ì¼í™˜ìœ¼ë¡œ ì¸í…” íŒŒìš´ë“œë¦¬ ì„œë¹„ìŠ¤ë¥¼ ê³ ë ¤í•  ê°€ëŠ¥ì„±ì´ ë†’ì•„ì§€ê³  ìžˆìœ¼ë©°, íŠ¹ížˆ ë¯¸êµ­ ë‚´ ì •ë¶€ ë°œì£¼ ë¬¼ëŸ‰ì´ë‚˜ êµ­ë°© ê´€ë ¨ ë°˜ë„ì²´ í”„ë¡œì íŠ¸ì—ì„œ ì‚¼ì„±ì „ìžê°€ ë°°ì œë  ìš°ë ¤ê°€ ì»¤ì§€ê³  ìžˆìŠµë‹ˆë‹¤`;
      } else {
        return `ì‚¼ì„±ì „ìžëŠ” ê¸€ë¡œë²Œ ë©”ëª¨ë¦¬ ë°˜ë„ì²´ ì‹œìž¥ ì ìœ ìœ¨ 43%ë¥¼ ì°¨ì§€í•˜ëŠ” ì ˆëŒ€ ê°•ìžë¡œì„œ, í–¥í›„ AI ë°˜ë„ì²´ ìŠˆí¼ì‚¬ì´í´ì˜ í•µì‹¬ ìˆ˜í˜œì£¼ ì—­í• ì„ í•  ê²ƒìœ¼ë¡œ ì˜ˆìƒë˜ë©°, íŠ¹ížˆ HBM ë¶„ì•¼ì—ì„œëŠ” SKí•˜ì´ë‹‰ìŠ¤ì™€ í•¨ê»˜ ì‚¬ì‹¤ìƒ ë…ì  êµ¬ì¡°ë¥¼ í˜•ì„±í•˜ê³  ìžˆì–´ ë†’ì€ ìˆ˜ìµì„±ê³¼ ì„±ìž¥ì„±ì„ ë™ì‹œì— í™•ë³´í•  ìˆ˜ ìžˆëŠ” ìœ ë¦¬í•œ ìœ„ì¹˜ì— ìžˆìŠµë‹ˆë‹¤`;
      }
    }
    
    else if (ticker === 'TSLA') { // í…ŒìŠ¬ë¼
      if (sentimentType === 'positive') {
        return `í…ŒìŠ¬ë¼ì˜ FSD ìžìœ¨ì£¼í–‰ ê¸°ìˆ ì´ ë¯¸êµ­ ë‚´ ìŠ¹ì¸ ë²”ìœ„ í™•ëŒ€ì™€ í•¨ê»˜ ìƒˆë¡œìš´ ìˆ˜ìµ ëª¨ë¸ë¡œ ë³¸ê²© ì „í™˜ë˜ê³  ìžˆìŠµë‹ˆë‹¤. ê¸°ì¡´ ì°¨ëŸ‰ íŒë§¤ í›„ ì¼íšŒì„± ìˆ˜ìµ êµ¬ì¡°ì—ì„œ ë²—ì–´ë‚˜ ì›” êµ¬ë…ë£Œ ê¸°ë°˜ì˜ ì§€ì†ì  ì†Œí”„íŠ¸ì›¨ì–´ ìˆ˜ìµ ì°½ì¶œì´ ê°€ëŠ¥í•´ì§€ë©´ì„œ í…ŒìŠ¬ë¼ì˜ ì‚¬ì—… ëª¨ë¸ì´ í•˜ë“œì›¨ì–´ì—ì„œ ì†Œí”„íŠ¸ì›¨ì–´ ì¤‘ì‹¬ìœ¼ë¡œ ì§„í™”í•˜ê³  ìžˆìœ¼ë©°, FSD ì›” êµ¬ë…ë£Œ 199ë‹¬ëŸ¬ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì „ ì„¸ê³„ í…ŒìŠ¬ë¼ ë³´ìœ  ëŒ€ìˆ˜ 600ë§ŒëŒ€ì˜ 10%ë§Œ ê°€ìž…í•´ë„ ì—°ê°„ 14ì–µë‹¬ëŸ¬ì˜ ì¶”ê°€ ë§¤ì¶œì´ ë°œìƒí•  ê²ƒìœ¼ë¡œ ì˜ˆìƒë©ë‹ˆë‹¤`;
      } else if (sentimentType === 'negative') {
        return `ì¤‘êµ­ ì „ê¸°ì°¨ ì‹œìž¥ì—ì„œ BYD, ë‹ˆì˜¤, ë¦¬ì˜¤í†  ë“± í˜„ì§€ ë¸Œëžœë“œë“¤ì˜ ê¸‰ì„±ìž¥ìœ¼ë¡œ í…ŒìŠ¬ë¼ì˜ ì‹œìž¥ì ìœ ìœ¨ì´ 2022ë…„ 12%ì—ì„œ 2024ë…„ 8%ë¡œ ê¸‰ê²©ížˆ í•˜ë½í•˜ê³  ìžˆìŠµë‹ˆë‹¤. ì¤‘êµ­ ì •ë¶€ì˜ ìžêµ­ ì „ê¸°ì°¨ ì—…ì²´ ì§€ì› ì •ì±…ê³¼ í˜„ì§€ ë¸Œëžœë“œë“¤ì˜ ê³µê²©ì ì¸ ê°€ê²© ì •ì±…ìœ¼ë¡œ í…ŒìŠ¬ë¼ëŠ” ê°€ê²© ê²½ìŸë ¥ì—ì„œ ìƒë‹¹í•œ ì••ë°•ì„ ë°›ê³  ìžˆìœ¼ë©°, ì¤‘êµ­ì€ í…ŒìŠ¬ë¼ ì „ì²´ ë§¤ì¶œì˜ 25%ì—ì„œ 30%ë¥¼ ì°¨ì§€í•˜ëŠ” í•µì‹¬ ì‹œìž¥ì´ë¯€ë¡œ ì´ ì§€ì—­ì—ì„œì˜ ì ìœ ìœ¨ í•˜ë½ì€ í…ŒìŠ¬ë¼ì˜ ê¸€ë¡œë²Œ ì„±ìž¥ ëª©í‘œ ë‹¬ì„±ê³¼ ìˆ˜ìµì„±ì— ì§ì ‘ì ì¸ íƒ€ê²©ì„ ì£¼ê³  ìžˆìŠµë‹ˆë‹¤`;
      } else {
        return `í…ŒìŠ¬ë¼ëŠ” ì „ê¸°ì°¨ ì‹œìž¥ì˜ ì„ ë„ì—…ì²´ë¡œì„œ ì—°ê°„ 200ë§ŒëŒ€ ìƒì‚° ëª©í‘œ ë‹¬ì„±ê³¼ í•¨ê»˜ ë¡œë´‡íƒì‹œ, ì—ë„ˆì§€ ì €ìž¥ ì‹œìŠ¤í…œ, íƒœì–‘ê´‘ íŒ¨ë„ ë“± ë‹¤ê°í™”ëœ ì‚¬ì—… í¬íŠ¸í´ë¦¬ì˜¤ë¥¼ í†µí•´ ë‹¨ìˆœí•œ ìžë™ì°¨ íšŒì‚¬ì—ì„œ ì¢…í•© ì—ë„ˆì§€ ê¸°ì—…ìœ¼ë¡œì˜ ì „í™˜ì„ ì¶”ì§„í•˜ê³  ìžˆì–´ ìž¥ê¸°ì  ì„±ìž¥ ê°€ëŠ¥ì„±ì´ ë§¤ìš° ë†’ì€ ìƒí™©ìž…ë‹ˆë‹¤`;
      }
    }
    
    else if (ticker === 'NVDA') { // ì—”ë¹„ë””ì•„
      if (sentimentType === 'positive') {
        return `ê¸€ë¡œë²Œ AI ì¸í”„ë¼ êµ¬ì¶• ë¶ìœ¼ë¡œ ì—”ë¹„ë””ì•„ì˜ H100, A100, H200 ë“± ê³ ì„±ëŠ¥ AI ì¹©ì— ëŒ€í•œ ìˆ˜ìš”ê°€ ê³µê¸‰ì„ í¬ê²Œ ì´ˆê³¼í•˜ë©´ì„œ 6ê°œì›” ì´ìƒì˜ ëŒ€ê¸° ì‹œê°„ì´ ë°œìƒí•˜ê³  ìžˆìŠµë‹ˆë‹¤. ë§ˆì´í¬ë¡œì†Œí”„íŠ¸, êµ¬ê¸€, ë©”íƒ€, ì•„ë§ˆì¡´ ë“± ë¹…í…Œí¬ ê¸°ì—…ë“¤ì´ ChatGPT, Bard, Llama ë“± ìƒì„±í˜• AI ì„œë¹„ìŠ¤ ê²½ìŸì„ ìœ„í•´ ëŒ€ê·œëª¨ ë°ì´í„°ì„¼í„° íˆ¬ìžë¥¼ í™•ëŒ€í•˜ë©´ì„œ ì—”ë¹„ë””ì•„ GPUì— ëŒ€í•œ ìˆ˜ìš”ëŠ” 2025ë…„ê¹Œì§€ ì—°ê°„ 50% ì´ìƒ ì„±ìž¥í•  ê²ƒìœ¼ë¡œ ì˜ˆìƒë˜ë©°, H100 í•˜ë‚˜ë‹¹ 25,000ë‹¬ëŸ¬ì—ì„œ 40,000ë‹¬ëŸ¬ì˜ ë†’ì€ ê°€ê²©ê³¼ 90% ì´ìƒì˜ ì´ˆê³ ìˆ˜ìµ ë§ˆì§„ êµ¬ì¡°ë¥¼ ê³ ë ¤í•  ë•Œ ì—”ë¹„ë””ì•„ëŠ” í–¥í›„ 2ë…„ì—ì„œ 3ë…„ê°„ ì—­ì‚¬ìƒ ìœ ë¡€ì—†ëŠ” ìˆ˜ìµì„±ì„ ê¸°ë¡í•  ê²ƒìœ¼ë¡œ ì „ë§ë©ë‹ˆë‹¤`;
      } else if (sentimentType === 'negative') {
        return `ë¯¸êµ­ ì •ë¶€ì˜ ì¤‘êµ­í–¥ AI ì¹© ìˆ˜ì¶œ ì œìž¬ ê°•í™”ë¡œ ì—”ë¹„ë””ì•„ê°€ ì „ì²´ ë§¤ì¶œì˜ 20%ì—ì„œ 25%ë¥¼ ì°¨ì§€í•˜ëŠ” ì¤‘êµ­ ì‹œìž¥ì—ì„œ ì™„ì „ížˆ ì°¨ë‹¨ë˜ë©´ì„œ ë‹¨ê¸°ì ìœ¼ë¡œ 50ì–µë‹¬ëŸ¬ì—ì„œ 70ì–µë‹¬ëŸ¬ì˜ ë§¤ì¶œ ì†ì‹¤ì´ ë¶ˆê°€í”¼í•œ ìƒí™©ìž…ë‹ˆë‹¤. ë˜í•œ ì¤‘êµ­ ì •ë¶€ê°€ ë°”ì´ë‘, ì•Œë¦¬ë°”ë°” ë“± ìžêµ­ AI ê¸°ì—…ë“¤ì—ê²Œ ì—”ë¹„ë””ì•„ GPU ëŒ€ì‹  í™”ì›¨ì´ Ascend ì‹œë¦¬ì¦ˆë‚˜ ìžì²´ ê°œë°œ AI ì¹© ì‚¬ìš©ì„ ê°•ë ¥ížˆ ê¶Œê³ í•˜ê³  ìžˆì–´ ì œìž¬ í•´ì œ ì´í›„ì—ë„ ì¤‘êµ­ ì‹œìž¥ íšŒë³µì´ ì–´ë ¤ìš¸ ê²ƒìœ¼ë¡œ ì˜ˆìƒë˜ë©°, ì´ëŠ” ìž¥ê¸°ì ìœ¼ë¡œ ì—”ë¹„ë””ì•„ì˜ ê¸€ë¡œë²Œ ì‹œìž¥ ì§€ë°°ë ¥ ì•½í™”ì™€ í•¨ê»˜ ì¤‘êµ­ ë‚´ AI ì¹© ìƒíƒœê³„ê°€ ë¯¸êµ­ ê¸°ìˆ ê³¼ ì™„ì „ížˆ ë¶„ë¦¬ë˜ëŠ” ë””ì»¤í”Œë§ í˜„ìƒì„ ê°€ì†í™”ì‹œí‚¬ ìš°ë ¤ê°€ ìžˆìŠµë‹ˆë‹¤`;
      } else {
        return `ì—”ë¹„ë””ì•„ëŠ” AI ì¹© ì‹œìž¥ì—ì„œ 80% ì´ìƒì˜ ì••ë„ì  ì ìœ ìœ¨ì„ ë°”íƒ•ìœ¼ë¡œ CUDA ì†Œí”„íŠ¸ì›¨ì–´ ìƒíƒœê³„ì™€ ê²°í•©ëœ ê°•ë ¥í•œ ê²½ìŸ ìš°ìœ„ë¥¼ êµ¬ì¶•í•˜ê³  ìžˆìœ¼ë©°, ì´ëŠ” ë‹¨ìˆœí•œ í•˜ë“œì›¨ì–´ ê²½ìŸì„ ë„˜ì–´ì„  í”Œëž«í¼ ì°¨ì›ì˜ ë…ì ë ¥ìœ¼ë¡œ ìž‘ìš©í•˜ì—¬ ê²½ìŸì‚¬ë“¤ì˜ ì¶”ê²©ì„ íš¨ê³¼ì ìœ¼ë¡œ ì°¨ë‹¨í•˜ê³  ìžˆëŠ” ìƒí™©ìž…ë‹ˆë‹¤`;
      }
    }
    
    else if (ticker === 'AAPL') { // ì• í”Œ
      if (sentimentType === 'positive') {
        return `ì•„ì´í° 15 Pro ì‹œë¦¬ì¦ˆì˜ í‹°íƒ€ëŠ„ ì†Œìž¬ ë„ìž…ê³¼ USB-C ì „í™˜, A17 Pro ì¹©ì…‹ì˜ 3ë‚˜ë…¸ ê³µì • ì ìš©ìœ¼ë¡œ í”„ë¦¬ë¯¸ì—„ ìŠ¤ë§ˆíŠ¸í° ì‹œìž¥ì—ì„œ ì• í”Œì˜ ê¸°ìˆ ì  ìš°ìœ„ì™€ ë¸Œëžœë“œ íŒŒì›Œê°€ ë”ìš± ê°•í™”ë˜ê³  ìžˆìŠµë‹ˆë‹¤. íŠ¹ížˆ ì¸ë„, ë™ë‚¨ì•„ì‹œì•„ ë“± ì‹ í¥ ì‹œìž¥ì—ì„œ ì¤‘ì‚°ì¸µ í™•ëŒ€ì™€ í•¨ê»˜ ì•„ì´í°ì— ëŒ€í•œ ìˆ˜ìš”ê°€ ê¸‰ì¦í•˜ê³  ìžˆìœ¼ë©°, ì• í”Œì˜ trade-in í”„ë¡œê·¸ëž¨ê³¼ í• ë¶€ ê¸ˆìœµ ì„œë¹„ìŠ¤ í™•ëŒ€ë¡œ ì ‘ê·¼ì„±ë„ í¬ê²Œ ê°œì„ ë˜ì—ˆê³ , ì•„ì´í°ì€ ì• í”Œ ì „ì²´ ë§¤ì¶œì˜ 50% ì´ìƒì„ ì°¨ì§€í•˜ëŠ” í•µì‹¬ ì‚¬ì—…ìœ¼ë¡œ ì•ˆì •ì ì¸ íŒë§¤ ì„±ìž¥ê³¼ í•¨ê»˜ ì•±ìŠ¤í† ì–´, ì•„ì´í´ë¼ìš°ë“œ ë“± ì„œë¹„ìŠ¤ ìƒíƒœê³„ í™•ìž¥ì˜ ê¸°ë°˜ ì—­í• ì„ í•˜ì—¬ ì• í”Œì˜ ìž¥ê¸°ì  ì„±ìž¥ ë™ë ¥ì„ ì œê³µí•˜ê³  ìžˆìŠµë‹ˆë‹¤`;
      } else if (sentimentType === 'negative') {
        return `ì¤‘êµ­ ì •ë¶€ê°€ ê³µë¬´ì›ê³¼ êµ­ìœ ê¸°ì—… ì§ì›ë“¤ì˜ ì•„ì´í° ì‚¬ìš©ì„ ê¸ˆì§€í•˜ê³  í™”ì›¨ì´ ë©”ì´íŠ¸60 ë“± ìžêµ­ ë¸Œëžœë“œ ì‚¬ìš©ì„ ê¶Œìž¥í•˜ë©´ì„œ ì• í”Œì˜ ì¤‘êµ­ ì‹œìž¥ ìž…ì§€ê°€ ê¸‰ê²©ížˆ ì•½í™”ë˜ê³  ìžˆìŠµë‹ˆë‹¤. ì¤‘êµ­ì€ ì• í”Œ ì „ì²´ ë§¤ì¶œì˜ 15%ì—ì„œ 20%ë¥¼ ì°¨ì§€í•˜ëŠ” í•µì‹¬ ì‹œìž¥ìœ¼ë¡œ, 2024ë…„ 1ë¶„ê¸° ì¤‘êµ­ ë‚´ ì•„ì´í° íŒë§¤ëŸ‰ì´ ì „ë…„ ë™ê¸° ëŒ€ë¹„ 24% ê¸‰ê°í•œ ê²ƒì€ ì‹¬ê°í•œ ê²½ê³  ì‹ í˜¸ì´ë©°, ë˜í•œ ì¤‘êµ­ ì†Œë¹„ìžë“¤ ì‚¬ì´ì—ì„œë„ ë°˜ë¯¸ ê°ì •ê³¼ ì• êµ­ì£¼ì˜ í™•ì‚°ìœ¼ë¡œ í™”ì›¨ì´, ìƒ¤ì˜¤ë¯¸ ë“± ì¤‘êµ­ ë¸Œëžœë“œ ì„ í˜¸ë„ê°€ ë†’ì•„ì§€ê³  ìžˆì–´ ì• í”Œì´ í–¥í›„ ìˆ˜ë…„ê°„ ì¤‘êµ­ ì‹œìž¥ì—ì„œ ì§€ì†ì ì¸ ì ìœ ìœ¨ í•˜ë½ê³¼ ë§¤ì¶œ ê°ì†Œë¥¼ ê²ªì„ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤`;
      } else {
        return `ì• í”Œì€ ì „ ì„¸ê³„ 20ì–µê°œ ì´ìƒì˜ í™œì„± ê¸°ê¸°ë¥¼ ë³´ìœ í•œ ê±°ëŒ€í•œ ìƒíƒœê³„ë¥¼ ë°”íƒ•ìœ¼ë¡œ í•˜ë“œì›¨ì–´ì™€ ì†Œí”„íŠ¸ì›¨ì–´ì™€ ì„œë¹„ìŠ¤ê°€ ì™„ë²½ížˆ í†µí•©ëœ ë…íŠ¹í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ëª¨ë¸ì„ êµ¬ì¶•í•˜ê³  ìžˆìœ¼ë©°, ì´ëŠ” ê³ ê° ì¶©ì„±ë„ì™€ ì „í™˜ ë¹„ìš© ìž¥ë²½ì„ ë†’ì—¬ ì§€ì†ì ì¸ í”„ë¦¬ë¯¸ì—„ ê°€ê²© ì •ì±…ê³¼ ì•ˆì •ì  ìˆ˜ìµ ì°½ì¶œì„ ê°€ëŠ¥í•˜ê²Œ í•˜ê³  ìžˆëŠ” ìƒí™©ìž…ë‹ˆë‹¤`;
      }
    }
    
    // ê¸°ë³¸ê°’
    return `í•´ë‹¹ ê¸°ì—…ì˜ í˜„ìž¬ ì‹œìž¥ ìƒí™©ê³¼ ì‚¬ì—… í™˜ê²½ì„ ì¢…í•©ì ìœ¼ë¡œ ê³ ë ¤í•  ë•Œ, ë‹¨ê¸°ì ì¸ ë³€ë™ì„±ë³´ë‹¤ëŠ” ìž¥ê¸°ì ì¸ ê¸°ì—… ê°€ì¹˜ì™€ ê²½ìŸë ¥ì„ ì¤‘ì‹¬ìœ¼ë¡œ í‰ê°€í•´ì•¼ í•  ê²ƒìœ¼ë¡œ íŒë‹¨ë˜ë©°, íˆ¬ìžìžë“¤ì€ ê´€ë ¨ ë¦¬ìŠ¤í¬ì™€ ê¸°íšŒ ìš”ì†Œë“¤ì„ ë©´ë°€ížˆ ê²€í† í•˜ì—¬ ì‹ ì¤‘í•œ íˆ¬ìž ê²°ì •ì„ ë‚´ë ¤ì•¼ í•  ê²ƒìœ¼ë¡œ ë³´ìž…ë‹ˆë‹¤`;
  }

  async updateSentimentReasoning(postId, ticker, newReasoning) {
    return new Promise((resolve, reject) => {
      this.db.run(`
        UPDATE sentiments 
        SET key_reasoning = ?
        WHERE post_id = ? AND ticker = ?
      `, [newReasoning, postId, ticker], function(err) {
        if (err) reject(err);
        else resolve(this.changes);
      });
    });
  }
}

const completer = new CompleteSentimentReasoner();
completer.generateCompleteSentimentReasoning().catch(console.error);