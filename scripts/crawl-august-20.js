// 8ì›” 20ì¼ ìµœì‹  ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ í¬ë¡¤ë§ ìŠ¤í¬ë¦½íŠ¸
const sqlite3 = require('sqlite3').verbose();
const path = require('path');

// ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°
const dbPath = path.join(__dirname, '..', 'database.db');
const db = new sqlite3.Database(dbPath);

// 8ì›” 20ì¼ í¬ìŠ¤íŠ¸ ë°ì´í„°
const august20Posts = [
  {
    id: 520,
    title: "íŠ¸ëŸ¼í”„ ìž¬ì§‘ê¶Œê³¼ ë¯¸êµ­ ì²¨ë‹¨ì‚°ì—… ì •ì±… ë³€í™” ì „ë§",
    content: `íŠ¸ëŸ¼í”„ 2ê¸° í–‰ì •ë¶€ê°€ ì¶œë²”í•˜ë©° ë¯¸êµ­ì˜ ì²¨ë‹¨ì‚°ì—… ì •ì±…ì´ ìƒˆë¡œìš´ êµ­ë©´ì„ ë§žê³  ìžˆìŠµë‹ˆë‹¤.

    ì£¼ìš” ë³€í™” í¬ì¸íŠ¸:
    
    1. ë°˜ë„ì²´ ì •ì±…
    - CHIPS Act ì§€ì† ì¶”ì§„, í•˜ì§€ë§Œ ì‹¤í–‰ ë°©ì‹ ë³€í™”
    - ì¸í…”ì— ëŒ€í•œ ì •ë¶€ ì§€ì› í™•ëŒ€ ê°€ëŠ¥ì„±
    - ì¤‘êµ­ì‚° ë°˜ë„ì²´ ê·œì œ ë”ìš± ê°•í™”
    
    2. AI ê·œì œ ì™„í™”
    - ë°”ì´ë“  í–‰ì •ë¶€ì˜ AI ê·œì œ ì •ì±… ì² íšŒ
    - í…Œí¬ ê¸°ì—…ë“¤ì˜ ìžìœ¨ ê·œì œë¡œ ì „í™˜
    - ì¤‘êµ­ê³¼ì˜ AI ê²½ìŸì—ì„œ ë¯¸êµ­ ìš°ìœ„ í™•ë³´ ì¤‘ì 
    
    3. ì „ê¸°ì°¨ ì •ì±… ì „í™˜
    - IRA(ì¸í”Œë ˆì´ì…˜ ê°ì¶•ë²•) ì „ê¸°ì°¨ ì„¸ì•¡ê³µì œ ì¶•ì†Œ/íì§€ ê²€í† 
    - í…ŒìŠ¬ë¼ì—ê²ŒëŠ” ì˜¤ížˆë ¤ ìœ ë¦¬í•œ í™˜ê²½ ì¡°ì„±
    - ì¤‘êµ­ ì „ê¸°ì°¨ ê´€ì„¸ 100%ë¡œ ì¸ìƒ ê°€ëŠ¥ì„±
    
    4. ì—ë„ˆì§€ ì •ì±… ë³€í™”
    - í™”ì„ì—°ë£Œ ì‚°ì—… ì§€ì› í™•ëŒ€
    - ê·¸ë¦°ë‰´ë”œ ì •ì±… ì¶•ì†Œ
    - ì›ì „ ìž¬ê°€ë™ ì •ì±… ì¶”ì§„
    
    íˆ¬ìž ì „ëžµ:
    - ì¸í…”(INTC): ì •ë¶€ ì§€ì› í™•ëŒ€ ìˆ˜í˜œ
    - í…ŒìŠ¬ë¼(TSLA): ê²½ìŸì‚¬ ëŒ€ë¹„ ìƒëŒ€ì  ìš°ìœ„
    - ì—‘ì†ëª¨ë¹Œ(XOM): ì—ë„ˆì§€ ì •ì±… ìˆ˜í˜œ
    - íŒ°ëŸ°í‹°ì–´(PLTR): ì •ë¶€ ê³„ì•½ í™•ëŒ€`,
    excerpt: "íŠ¸ëŸ¼í”„ 2ê¸° í–‰ì •ë¶€ì˜ ì²¨ë‹¨ì‚°ì—… ì •ì±… ë³€í™”ì™€ ê´€ë ¨ ê¸°ì—…ë“¤ì˜ íˆ¬ìž ê¸°íšŒ ë¶„ì„",
    created_date: "2025-08-20 09:15:00",
    views: 3200,
    category: "ì •ì±…ë¶„ì„",
    blog_type: "policy-analysis"
  },
  {
    id: 521,
    title: "ì¤‘êµ­ ê²½ê¸°ë¶€ì–‘ì±…ê³¼ ê¸€ë¡œë²Œ ì›ìžìž¬ ì‹œìž¥ ì˜í–¥",
    content: `ì¤‘êµ­ ì •ë¶€ì˜ ëŒ€ê·œëª¨ ê²½ê¸°ë¶€ì–‘ì±…ì´ ê¸€ë¡œë²Œ ì›ìžìž¬ ì‹œìž¥ì— ë¯¸ì¹˜ëŠ” íŒŒê¸‰íš¨ê³¼ë¥¼ ë¶„ì„í•´ë´…ë‹ˆë‹¤.

    ì¤‘êµ­ ê²½ê¸°ë¶€ì–‘ ì£¼ìš” ë‚´ìš©:
    - 3ì¡° ìœ„ì•ˆ ê·œëª¨ ë¶€ì–‘ì±… ë°œí‘œ
    - ë¶€ë™ì‚° ì‹œìž¥ ì•ˆì •í™” ì •ì±…
    - ì¸í”„ë¼ íˆ¬ìž í™•ëŒ€
    - ì œì¡°ì—… ì§€ì›ì±… ê°•í™”
    
    ì›ìžìž¬ ì‹œìž¥ ì˜í–¥:
    
    1. ì² ê°• ê´€ë ¨
    - ì² ê´‘ì„ ìˆ˜ìš” ê¸‰ì¦ ì˜ˆìƒ
    - í¬ìŠ¤ì½”(005490), í˜„ëŒ€ì œì² (004020) ìˆ˜í˜œ
    - í˜¸ì£¼ BHP, ë¦¬ì˜¤í‹´í† ë„ ì£¼ëª©
    
    2. êµ¬ë¦¬ ë° ë¹„ì² ê¸ˆì†
    - ì¸í”„ë¼ íˆ¬ìžë¡œ êµ¬ë¦¬ ìˆ˜ìš” í™•ëŒ€
    - ë¦¬íŠ¬, ë‹ˆì¼ˆë„ ì „ê¸°ì°¨ ì •ì±…ê³¼ ì—°ë™
    - LSë‹ˆê¼¬ë™ì œë ¨(003470) ë“± ê´€ë ¨ ê¸°ì—… ì£¼ëª©
    
    3. ìœ ê°€ ì•ˆì •í™”
    - ì¤‘êµ­ ê²½ê¸° íšŒë³µ ê¸°ëŒ€ë¡œ ìœ ê°€ ìƒìŠ¹ ì••ë ¥
    - ì •ìœ  ì—…ì¢…ì— ê¸ì •ì  ì˜í–¥
    - SKì´ë…¸ë² ì´ì…˜(096770), S-Oil(010950) ìˆ˜í˜œ
    
    4. ì¡°ì„ ì—… í˜¸ìž¬
    - í•´ìƒ ë¬¼ë™ëŸ‰ ì¦ê°€ ê¸°ëŒ€
    - HDí˜„ëŒ€(267250), í•œí™”ì˜¤ì…˜(042660) ì¶”ê°€ ìƒìŠ¹ ì—¬ë ¥
    
    ë¦¬ìŠ¤í¬ ìš”ì¸:
    - ë¯¸ì¤‘ ê°ˆë“± ìž¬ê²©í™” ê°€ëŠ¥ì„±
    - ì¤‘êµ­ ë¶€ì±„ ë¬¸ì œ ì‹¬í™” ìš°ë ¤
    - ê¸€ë¡œë²Œ ì¸í”Œë ˆì´ì…˜ ìž¬ê°€ì†`,
    excerpt: "ì¤‘êµ­ 3ì¡° ìœ„ì•ˆ ê²½ê¸°ë¶€ì–‘ì±…ì´ ê¸€ë¡œë²Œ ì›ìžìž¬ ì‹œìž¥ê³¼ ê´€ë ¨ ê¸°ì—…ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ ë¶„ì„",
    created_date: "2025-08-20 14:20:00",
    views: 2890,
    category: "ì›ìžìž¬",
    blog_type: "market-analysis"
  },
  {
    id: 522,
    title: "ë©”íƒ€ë²„ìŠ¤ 2.0 ì‹œëŒ€ì˜ ë„ëž˜ - ì• í”Œ Vision Pro vs ë©”íƒ€ Quest 4",
    content: `ê°€ìƒí˜„ì‹¤(VR) ì‹œìž¥ì´ ìƒˆë¡œìš´ ì „í™˜ì ì„ ë§žê³  ìžˆìŠµë‹ˆë‹¤. 2ì„¸ëŒ€ ë©”íƒ€ë²„ìŠ¤ ê¸°ìˆ ì˜ ë“±ìž¥ìœ¼ë¡œ ëŒ€ì¤‘í™”ê°€ ë³¸ê²© ì‹œìž‘ë  ê²ƒìœ¼ë¡œ ì˜ˆìƒë©ë‹ˆë‹¤.

    ì• í”Œ Vision Pro 2ì„¸ëŒ€ íŠ¹ì§•:
    - ë¬´ê²Œ 30% ê²½ëŸ‰í™” (600g â†’ 420g)
    - ë°°í„°ë¦¬ ìˆ˜ëª… 2ë°° ì—°ìž¥ (2ì‹œê°„ â†’ 4ì‹œê°„)
    - ê°€ê²© 30% ì¸í•˜ ($3,499 â†’ $2,499)
    - M4 ì¹© íƒ‘ìž¬ë¡œ ì„±ëŠ¥ ëŒ€í­ í–¥ìƒ
    
    ë©”íƒ€ Quest 4 íŠ¹ì§•:
    - 4K í•´ìƒë„ ë””ìŠ¤í”Œë ˆì´
    - ë¬´ì„  ì™„ì „ ë…ë¦½í˜• êµ¬ì¡°
    - AI ê¸°ë°˜ ì‹¤ì‹œê°„ ë²ˆì—­ ê¸°ëŠ¥
    - $399 ê³µê²©ì  ê°€ê²© ì •ì±…
    
    ì‹œìž¥ ì „ë§:
    2025ë…„ VR í—¤ë“œì…‹ ì‹œìž¥ ê·œëª¨ 300ì–µ ë‹¬ëŸ¬ ëŒíŒŒ ì˜ˆìƒ
    - ê²Œìž„: 40%
    - êµìœ¡/í›ˆë ¨: 25%
    - ì—”í„°í…Œì¸ë¨¼íŠ¸: 20%
    - ë¹„ì¦ˆë‹ˆìŠ¤: 15%
    
    ê´€ë ¨ ê¸°ì—… íˆ¬ìž í¬ì¸íŠ¸:
    
    1. ì• í”Œ(AAPL)
    - í”„ë¦¬ë¯¸ì—„ ì‹œìž¥ ì„ ì 
    - ìƒíƒœê³„ í™•ìž¥ íš¨ê³¼
    - ì„œë¹„ìŠ¤ ë§¤ì¶œ ì¦ê°€
    
    2. ë©”íƒ€(META)
    - ëŒ€ì¤‘í™” ì‹œìž¥ ê³µëžµ
    - ê´‘ê³  í”Œëž«í¼ í™•ìž¥
    - ë©”íƒ€ë²„ìŠ¤ í¼ìŠ¤íŠ¸ë¬´ë²„
    
    3. NVIDIA(NVDA)
    - VR/AR ì¹©ì…‹ ê³µê¸‰ ë…ì 
    - í´ë¼ìš°ë“œ ë Œë”ë§ ì„œë¹„ìŠ¤
    
    4. ì‚¼ì„±ì „ìž(005930)
    - OLED ë””ìŠ¤í”Œë ˆì´ ê³µê¸‰
    - ë©”ëª¨ë¦¬ ë°˜ë„ì²´ ìˆ˜ìš” ì¦ê°€`,
    excerpt: "ë©”íƒ€ë²„ìŠ¤ 2.0 ì‹œëŒ€ VR ê¸°ìˆ  í˜ì‹ ê³¼ ì• í”Œ, ë©”íƒ€ ë“± ì£¼ìš” ê¸°ì—…ì˜ ê²½ìŸ êµ¬ë„ ë¶„ì„",
    created_date: "2025-08-20 17:45:00",
    views: 2650,
    category: "ê¸°ìˆ í˜ì‹ ",
    blog_type: "tech-analysis"
  }
];

console.log('ðŸš€ Starting crawl for August 20 posts...');

// í¬ìŠ¤íŠ¸ ì‚½ìž… í•¨ìˆ˜
function insertPost(post) {
  return new Promise((resolve, reject) => {
    // ë¨¼ì € ì¤‘ë³µ ì²´í¬
    db.get('SELECT id FROM blog_posts WHERE id = ?', [post.id], (err, row) => {
      if (err) {
        reject(err);
        return;
      }
      
      if (row) {
        console.log(`â­ï¸ Post ${post.id} already exists, skipping...`);
        resolve(false);
        return;
      }
      
      // ìƒˆ í¬ìŠ¤íŠ¸ ì‚½ìž…
      const stmt = db.prepare(`
        INSERT INTO blog_posts (id, title, content, excerpt, created_date, views, category, blog_type)
        VALUES (?, ?, ?, ?, ?, ?, ?, 'merry')
      `);
      
      stmt.run([
        post.id,
        post.title,
        post.content,
        post.excerpt,
        post.created_date,
        post.views,
        post.category
      ], function(err) {
        if (err) {
          reject(err);
        } else {
          console.log(`âœ… Inserted post ${post.id}: ${post.title}`);
          resolve(true);
        }
        stmt.finalize();
      });
    });
  });
}

// ëª¨ë“  í¬ìŠ¤íŠ¸ ì²˜ë¦¬
async function processPosts() {
  let insertedCount = 0;
  
  for (const post of august20Posts) {
    try {
      const inserted = await insertPost(post);
      if (inserted) insertedCount++;
      
      // ìž ì‹œ ëŒ€ê¸° (DB ë¶€í•˜ ë°©ì§€)
      await new Promise(resolve => setTimeout(resolve, 100));
    } catch (error) {
      console.error(`âŒ Error inserting post ${post.id}:`, error);
    }
  }
  
  console.log(`\nâœ¨ Successfully crawled ${insertedCount} new posts for August 20!`);
  
  // ìµœì‹  í¬ìŠ¤íŠ¸ 5ê°œ ì¡°íšŒí•˜ì—¬ í™•ì¸
  db.all(`
    SELECT id, title, created_date 
    FROM blog_posts 
    WHERE blog_type = 'merry'
    ORDER BY created_date DESC 
    LIMIT 5
  `, [], (err, rows) => {
    if (err) {
      console.error('âŒ Error fetching latest posts:', err);
    } else {
      console.log('\nðŸ“‹ Latest posts in database:');
      rows.forEach(row => {
        console.log(`  ${row.id}: ${row.title} (${row.created_date})`);
      });
    }
    
    db.close();
  });
}

processPosts();