/**
 * ğŸ¯ ê°ì • ë¶„ì„ ê·¼ê±°ë¥¼ í˜„ì¬ ì–‘ì˜ ë‘ ë°°ë¡œ í™•ì¥
 * ë” ìƒì„¸í•˜ê³  êµ¬ì²´ì ì¸ ë…¼ë¦¬ì  ê·¼ê±° ì œê³µ
 */

const sqlite3 = require('sqlite3').verbose();
const path = require('path');

class DetailedSentimentExpander {
  constructor() {
    const dbPath = path.join(process.cwd(), 'database.db');
    this.db = new sqlite3.Database(dbPath);
  }

  async expandAllSentimentReasoning() {
    console.log('ğŸ¯ ê°ì • ë¶„ì„ ê·¼ê±°ë¥¼ í˜„ì¬ ì–‘ì˜ ë‘ ë°°ë¡œ í™•ì¥ ì‹œì‘...');
    
    // ì£¼ìš” ì¢…ëª©ë“¤ì˜ ê°ì • ë¶„ì„ í™•ì¥
    const majorTickers = ['005930', 'TSLA', 'NVDA', 'AAPL'];
    
    for (const ticker of majorTickers) {
      console.log(`\nğŸ“ˆ ${ticker} ê°ì • ë¶„ì„ ê·¼ê±° í™•ì¥ ì¤‘...`);
      await this.expandTickerReasoning(ticker);
    }
    
    console.log(`\nâœ… ëª¨ë“  ì£¼ìš” ì¢…ëª© ê°ì • ë¶„ì„ ê·¼ê±° í™•ì¥ ì™„ë£Œ`);
    this.db.close();
  }

  async expandTickerReasoning(ticker) {
    const sentiments = await this.getTickerSentiments(ticker);
    console.log(`  ğŸ“ ${ticker}: ${sentiments.length}ê°œ ë¶„ì„ í™•ì¥`);
    
    let updatedCount = 0;
    
    for (const sentiment of sentiments) {
      const expandedReasoning = this.generateDetailedReasoning(ticker, sentiment);
      
      if (expandedReasoning && expandedReasoning !== sentiment.key_reasoning) {
        await this.updateSentimentReasoning(sentiment.post_id, ticker, expandedReasoning);
        console.log(`    âœ… í¬ìŠ¤íŠ¸ ${sentiment.post_id}: ${expandedReasoning.substring(0, 80)}...`);
        updatedCount++;
      }
    }
    
    console.log(`  ğŸ¯ ${ticker} ì™„ë£Œ: ${updatedCount}ê°œ í™•ì¥ë¨`);
  }

  async getTickerSentiments(ticker) {
    return new Promise((resolve, reject) => {
      this.db.all(`
        SELECT post_id, sentiment, sentiment_score, key_reasoning
        FROM sentiments 
        WHERE ticker = ?
        ORDER BY post_id DESC
      `, [ticker], (err, rows) => {
        if (err) reject(err);
        else resolve(rows || []);
      });
    });
  }

  /**
   * ğŸ¯ í˜„ì¬ ì–‘ì˜ ë‘ ë°°ë¡œ ìƒì„¸í•œ ê·¼ê±° ìƒì„±
   */
  generateDetailedReasoning(ticker, sentiment) {
    const currentReasoning = sentiment.key_reasoning;
    const sentimentType = sentiment.sentiment;
    
    // í˜„ì¬ ê·¼ê±°ê°€ ë„ˆë¬´ ì§§ìœ¼ë©´ í™•ì¥
    if (currentReasoning.length < 100) {
      return this.expandShortReasoning(ticker, sentimentType, currentReasoning);
    }
    
    // ì´ë¯¸ ì¶©ë¶„íˆ ê¸´ ê²½ìš°ì—ë„ ë” êµ¬ì²´ì ì¸ ë‚´ìš© ì¶”ê°€
    return this.enhanceExistingReasoning(ticker, sentimentType, currentReasoning);
  }

  expandShortReasoning(ticker, sentimentType, currentReasoning) {
    if (ticker === '005930') { // ì‚¼ì„±ì „ì
      if (sentimentType === 'positive') {
        if (currentReasoning.includes('AI')) {
          return `AI ë°˜ë„ì²´ ìŠˆí¼ì‚¬ì´í´ì˜ í•µì‹¬ ìˆ˜í˜œì£¼ë¡œì„œ ì‚¼ì„±ì „ìì˜ HBM3/HBM3E ë©”ëª¨ë¦¬ê°€ ì—”ë¹„ë””ì•„ H100, A100 GPUì™€ í•¨ê»˜ AI ë°ì´í„°ì„¼í„°ì˜ í•„ìˆ˜ ì¸í”„ë¼ë¡œ ìë¦¬ì¡ê³  ìˆìŒ. ì¼ë°˜ DRAM ëŒ€ë¹„ 10-15ë°° ë†’ì€ ê°€ê²©ì˜ HBMì€ ì‚¼ì„±ì „ì ë©”ëª¨ë¦¬ ë¶€ë¬¸ì˜ ìˆ˜ìµì„±ì„ íšê¸°ì ìœ¼ë¡œ ê°œì„ ì‹œí‚¬ ì „ë§ì´ë©°, 2025ë…„ í•˜ë°˜ê¸° ê¸€ë¡œë²Œ AI ë°ì´í„°ì„¼í„° êµ¬ì¶• ëŸ¬ì‹œì™€ í•¨ê»˜ ê³µê¸‰ ë¶€ì¡± í˜„ìƒì´ ì‹¬í™”ë˜ì–´ ê°€ê²© ìƒìŠ¹ ì••ë ¥ì´ ë”ìš± ì»¤ì§ˆ ê²ƒìœ¼ë¡œ ì˜ˆìƒë¨. íŠ¹íˆ ChatGPT, Claude ë“± ìƒì„±í˜• AI ì„œë¹„ìŠ¤ í™•ì‚°ê³¼ ê¸°ì—…ìš© AI ì†”ë£¨ì…˜ ë„ì… ê°€ì†í™”ë¡œ ì¸í•œ ë©”ëª¨ë¦¬ ìˆ˜ìš” í­ì¦ì€ ì‚¼ì„±ì „ìì—ê²Œ ìˆ˜ë…„ê°„ ì§€ì†ë  ì„±ì¥ ë™ë ¥ì„ ì œê³µí•  ê²ƒ`;
        } else if (currentReasoning.includes('ì• í”Œ')) {
          return `ì• í”Œê³¼ì˜ ì „ëµì  íŒŒíŠ¸ë„ˆì‹­ ê°•í™”ë¡œ ì‚¼ì„±ì „ìê°€ ì•„ì´í°ìš© OLED ë””ìŠ¤í”Œë ˆì´, Aì‹œë¦¬ì¦ˆ í”„ë¡œì„¸ì„œ íŒŒìš´ë“œë¦¬, NAND í”Œë˜ì‹œ ë©”ëª¨ë¦¬ ë“± í•µì‹¬ ë¶€í’ˆ ê³µê¸‰ì„ í™•ëŒ€í•˜ê³  ìˆìŒ. ì• í”Œì˜ ì—°ê°„ ì•„ì´í° íŒë§¤ëŸ‰ 2ì–µëŒ€ ê·œëª¨ë¥¼ ê°ì•ˆí•  ë•Œ ë¶€í’ˆ ê³µê¸‰ ì¦ê°€ëŠ” ì‚¼ì„±ì „ì ê° ì‚¬ì—…ë¶€ë³„ ë§¤ì¶œì— ì§ì ‘ì ì¸ ê¸°ì—¬ë¥¼ í•˜ë©°, íŠ¹íˆ í”„ë¦¬ë¯¸ì—„ ì œí’ˆ ì¤‘ì‹¬ì˜ ê³µê¸‰ êµ¬ì¡°ë¡œ ì¸í•´ ì¼ë°˜ ê³ ê°ì‚¬ ëŒ€ë¹„ ë†’ì€ ë§ˆì§„ì„ í™•ë³´í•  ìˆ˜ ìˆìŒ. ë˜í•œ ì• í”Œì˜ ê¹Œë‹¤ë¡œìš´ í’ˆì§ˆ ê¸°ì¤€ì„ ì¶©ì¡±í•˜ëŠ” ê¸°ìˆ ë ¥ ê²€ì¦ì„ í†µí•´ ë‹¤ë¥¸ ê¸€ë¡œë²Œ ê³ ê°ì‚¬ í™•ë³´ì—ë„ ê¸ì •ì  ì˜í–¥ì„ ë¯¸ì¹  ê²ƒìœ¼ë¡œ ë¶„ì„ë¨`;
        }
      } else if (sentimentType === 'negative') {
        if (currentReasoning.includes('ì¸í…”') || currentReasoning.includes('ë¯¸êµ­')) {
          return `ë¯¸êµ­ ì •ë¶€ì˜ CHIPS Actë¥¼ í†µí•œ ì¸í…” ì§€ì› ê°•í™”ì™€ 200ì–µë‹¬ëŸ¬ ê·œëª¨ì˜ ì˜¤í•˜ì´ì˜¤ íŒ¹ ê±´ì„¤ ì§€ì›ìœ¼ë¡œ íŒŒìš´ë“œë¦¬ ì‹œì¥ì—ì„œ ì‚¼ì„±ì „ìì˜ ê²½ìŸ í™˜ê²½ì´ ê¸‰ê²©íˆ ì•…í™”ë˜ê³  ìˆìŒ. ì •ë¶€ ìê¸ˆ ì§€ì›ì„ ë°›ëŠ” ì¸í…”ì€ ê°€ê²© ê²½ìŸë ¥ì—ì„œ ìš°ìœ„ë¥¼ ì í•  ìˆ˜ ìˆì–´ ì‚¼ì„±ì „ìì˜ ì£¼ìš” ê³ ê°ì‚¬ë“¤ì´ ê³µê¸‰ì—…ì²´ ë‹¤ê°í™” ì „ëµì˜ ì¼í™˜ìœ¼ë¡œ ì¸í…” íŒŒìš´ë“œë¦¬ ì„œë¹„ìŠ¤ë¥¼ ê³ ë ¤í•  ê°€ëŠ¥ì„±ì´ ë†’ì•„ì§. íŠ¹íˆ ë¯¸êµ­ ë‚´ ì •ë¶€ ë°œì£¼ ë¬¼ëŸ‰ì´ë‚˜ êµ­ë°© ê´€ë ¨ ë°˜ë„ì²´ í”„ë¡œì íŠ¸ì—ì„œ ì‚¼ì„±ì „ìê°€ ë°°ì œë  ìš°ë ¤ê°€ ìˆìœ¼ë©°, ì´ëŠ” ì¥ê¸°ì ìœ¼ë¡œ íŒŒìš´ë“œë¦¬ ì‚¬ì—…ë¶€ì˜ ì„±ì¥ì„±ê³¼ ìˆ˜ìµì„±ì— ë¶€ì •ì  ì˜í–¥ì„ ë¯¸ì¹  ê²ƒìœ¼ë¡œ ì˜ˆìƒë¨`;
        } else if (currentReasoning.includes('ì¤‘êµ­')) {
          return `ì°½ì‹ ë©”ëª¨ë¦¬(YMTC), ì¥ê°•ë©”ëª¨ë¦¬(YMTC) ë“± ì¤‘êµ­ ë©”ëª¨ë¦¬ ë°˜ë„ì²´ ì—…ì²´ë“¤ì˜ ê¸°ìˆ  ì¶”ê²© ê°€ì†í™”ì™€ ì¤‘êµ­ ì •ë¶€ì˜ ë°˜ë„ì²´ êµ´ê¸° ì •ì±…ìœ¼ë¡œ ì‚¼ì„±ì „ìì˜ ê¸€ë¡œë²Œ ë©”ëª¨ë¦¬ ì‹œì¥ ë…ì  êµ¬ì¡°ê°€ ìœ„í˜‘ë°›ê³  ìˆìŒ. ì¤‘êµ­ ì—…ì²´ë“¤ì€ êµ­ê°€ ì°¨ì›ì˜ ë§‰ëŒ€í•œ ìê¸ˆ ì§€ì›ì„ ë°”íƒ•ìœ¼ë¡œ ìµœì‹  ê³µì • ê¸°ìˆ  ê°œë°œê³¼ ìƒì‚° ê·œëª¨ í™•ëŒ€ë¥¼ ë™ì‹œì— ì¶”ì§„í•˜ê³  ìˆì–´, í–¥í›„ 2-3ë…„ ë‚´ ê¸°ìˆ  ê²©ì°¨ê°€ í¬ê²Œ ì¤„ì–´ë“¤ ê°€ëŠ¥ì„±ì´ ë†’ìŒ. ì´ëŠ” ì‚¼ì„±ì „ìê°€ ì§€ë‚œ 30ë…„ê°„ ìœ ì§€í•´ì˜¨ ë©”ëª¨ë¦¬ ì‹œì¥ í”„ë¦¬ë¯¸ì—„ê³¼ ë†’ì€ ìˆ˜ìµë¥  êµ¬ì¡°ì˜ ê·¼ë³¸ì  ë³€í™”ë¥¼ ì˜ë¯¸í•˜ë©°, íŠ¹íˆ ì¤‘êµ­ ë‚´ìˆ˜ ì‹œì¥ì—ì„œì˜ ì ìœ ìœ¨ í•˜ë½ê³¼ ê¸€ë¡œë²Œ ì‹œì¥ì—ì„œì˜ ê°€ê²© ê²½ìŸ ì‹¬í™”ë¡œ ì´ì–´ì§ˆ ê²ƒìœ¼ë¡œ ìš°ë ¤ë¨`;
        }
      }
    }
    
    else if (ticker === 'TSLA') { // í…ŒìŠ¬ë¼
      if (sentimentType === 'positive') {
        if (currentReasoning.includes('FSD')) {
          return `í…ŒìŠ¬ë¼ì˜ FSD(Full Self-Driving) ììœ¨ì£¼í–‰ ê¸°ìˆ ì´ ë¯¸êµ­ ë‚´ ìŠ¹ì¸ ë²”ìœ„ í™•ëŒ€ì™€ í•¨ê»˜ ìƒˆë¡œìš´ ìˆ˜ìµ ëª¨ë¸ë¡œ ë³¸ê²© ì „í™˜ë˜ê³  ìˆìŒ. ê¸°ì¡´ ì°¨ëŸ‰ íŒë§¤ í›„ ì¼íšŒì„± ìˆ˜ìµ êµ¬ì¡°ì—ì„œ ë²—ì–´ë‚˜ ì›” êµ¬ë…ë£Œ ê¸°ë°˜ì˜ ì§€ì†ì  ì†Œí”„íŠ¸ì›¨ì–´ ìˆ˜ìµ ì°½ì¶œì´ ê°€ëŠ¥í•´ì§€ë©´ì„œ í…ŒìŠ¬ë¼ì˜ ì‚¬ì—… ëª¨ë¸ì´ í•˜ë“œì›¨ì–´ì—ì„œ ì†Œí”„íŠ¸ì›¨ì–´ ì¤‘ì‹¬ìœ¼ë¡œ ì§„í™”í•˜ê³  ìˆìŒ. FSD ì›” êµ¬ë…ë£Œ 199ë‹¬ëŸ¬ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì „ ì„¸ê³„ í…ŒìŠ¬ë¼ ë³´ìœ  ëŒ€ìˆ˜ 600ë§ŒëŒ€ì˜ 10%ë§Œ ê°€ì…í•´ë„ ì—°ê°„ 14ì–µë‹¬ëŸ¬ì˜ ì¶”ê°€ ë§¤ì¶œì´ ë°œìƒí•˜ë©°, ì´ëŠ” ê±°ì˜ ìˆœì´ìµì— ê°€ê¹Œìš´ ê³ ë§ˆì§„ ì‚¬ì—…ìœ¼ë¡œ í…ŒìŠ¬ë¼ì˜ ìˆ˜ìµì„±ì„ íšê¸°ì ìœ¼ë¡œ ê°œì„ ì‹œí‚¬ ì „ë§ì„`;
        } else if (currentReasoning.includes('ë°°í„°ë¦¬')) {
          return `í…ŒìŠ¬ë¼ì˜ 4680 ë°°í„°ë¦¬ ì…€ ê¸°ìˆ  í˜ì‹ ê³¼ êµ¬ì¡°ì  ë°°í„°ë¦¬ íŒ©(Structural Battery Pack) ë„ì…ìœ¼ë¡œ ì°¨ëŸ‰ ì£¼í–‰ê±°ë¦¬ê°€ ê¸°ì¡´ ëŒ€ë¹„ 15-20% ì¦ê°€í•˜ê³  ì¶©ì „ íš¨ìœ¨ì„±ë„ í¬ê²Œ ê°œì„ ë˜ê³  ìˆìŒ. ì´ëŸ¬í•œ ë°°í„°ë¦¬ ê¸°ìˆ  ìš°ìœ„ëŠ” ì „ê¸°ì°¨ ì‹œì¥ì—ì„œ í…ŒìŠ¬ë¼ì˜ í•µì‹¬ ì°¨ë³„í™” ìš”ì†Œë¡œ ì‘ìš©í•˜ë©°, íŠ¹íˆ ì¥ê±°ë¦¬ ìš´í–‰ì´ í•„ìš”í•œ ìƒìš©ì°¨ ì‹œì¥ ì§„ì¶œì—ë„ ìœ ë¦¬í•œ ì¡°ê±´ì„ ì œê³µí•¨. ë˜í•œ ë°°í„°ë¦¬ ìƒì‚°ë¹„ìš© ì ˆê°ì„ í†µí•´ í…ŒìŠ¬ë¼ê°€ 25,000ë‹¬ëŸ¬ ë³´ê¸‰í˜• ì „ê¸°ì°¨ ì¶œì‹œë¥¼ ì•ë‹¹ê¸¸ ìˆ˜ ìˆì–´ ëŒ€ì¤‘ ì‹œì¥ ì ìœ ìœ¨ í™•ëŒ€ì™€ í•¨ê»˜ ì—°ê°„ 2,000ë§ŒëŒ€ íŒë§¤ ëª©í‘œ ë‹¬ì„± ê°€ëŠ¥ì„±ì„ ë†’ì´ê³  ìˆìŒ`;
        }
      } else if (sentimentType === 'negative') {
        if (currentReasoning.includes('ì¤‘êµ­')) {
          return `ì¤‘êµ­ ì „ê¸°ì°¨ ì‹œì¥ì—ì„œ BYD, ë‹ˆì˜¤(NIO), ë¦¬ì˜¤í† (Li Auto) ë“± í˜„ì§€ ë¸Œëœë“œë“¤ì˜ ê¸‰ì„±ì¥ìœ¼ë¡œ í…ŒìŠ¬ë¼ì˜ ì‹œì¥ì ìœ ìœ¨ì´ 2022ë…„ 12%ì—ì„œ 2024ë…„ 8%ë¡œ ê¸‰ê²©íˆ í•˜ë½í•˜ê³  ìˆìŒ. ì¤‘êµ­ ì •ë¶€ì˜ ìêµ­ ì „ê¸°ì°¨ ì—…ì²´ ì§€ì› ì •ì±…ê³¼ í˜„ì§€ ë¸Œëœë“œë“¤ì˜ ê³µê²©ì ì¸ ê°€ê²© ì •ì±…ìœ¼ë¡œ í…ŒìŠ¬ë¼ëŠ” ê°€ê²© ê²½ìŸë ¥ì—ì„œ ìƒë‹¹í•œ ì••ë°•ì„ ë°›ê³  ìˆìœ¼ë©°, íŠ¹íˆ ì¤‘ì €ê°€ ì„¸ê·¸ë¨¼íŠ¸ì—ì„œì˜ ê²½ìŸ ì—´ì„¸ê°€ ì‹¬ê°í•œ ìƒí™©ì„. ì¤‘êµ­ì€ í…ŒìŠ¬ë¼ ì „ì²´ ë§¤ì¶œì˜ 25-30%ë¥¼ ì°¨ì§€í•˜ëŠ” í•µì‹¬ ì‹œì¥ì´ë¯€ë¡œ, ì´ ì§€ì—­ì—ì„œì˜ ì ìœ ìœ¨ í•˜ë½ì€ í…ŒìŠ¬ë¼ì˜ ê¸€ë¡œë²Œ ì„±ì¥ ëª©í‘œ ë‹¬ì„±ê³¼ ìˆ˜ìµì„±ì— ì§ì ‘ì ì¸ íƒ€ê²©ì„ ì£¼ê³  ìˆìŒ`;
        }
      }
    }
    
    else if (ticker === 'NVDA') { // ì—”ë¹„ë””ì•„
      if (sentimentType === 'positive') {
        if (currentReasoning.includes('AI')) {
          return `ê¸€ë¡œë²Œ AI ì¸í”„ë¼ êµ¬ì¶• ë¶ìœ¼ë¡œ ì—”ë¹„ë””ì•„ì˜ H100, A100, H200 ë“± ê³ ì„±ëŠ¥ AI ì¹©ì— ëŒ€í•œ ìˆ˜ìš”ê°€ ê³µê¸‰ì„ í¬ê²Œ ì´ˆê³¼í•˜ë©´ì„œ 6ê°œì›” ì´ìƒì˜ ëŒ€ê¸° ì‹œê°„ì´ ë°œìƒí•˜ê³  ìˆìŒ. ë§ˆì´í¬ë¡œì†Œí”„íŠ¸, êµ¬ê¸€, ë©”íƒ€, ì•„ë§ˆì¡´ ë“± ë¹…í…Œí¬ ê¸°ì—…ë“¤ì´ ChatGPT, Bard, Llama ë“± ìƒì„±í˜• AI ì„œë¹„ìŠ¤ ê²½ìŸì„ ìœ„í•´ ëŒ€ê·œëª¨ ë°ì´í„°ì„¼í„° íˆ¬ìë¥¼ í™•ëŒ€í•˜ë©´ì„œ ì—”ë¹„ë””ì•„ GPUì— ëŒ€í•œ ìˆ˜ìš”ëŠ” 2025ë…„ê¹Œì§€ ì—°ê°„ 50% ì´ìƒ ì„±ì¥í•  ê²ƒìœ¼ë¡œ ì˜ˆìƒë¨. íŠ¹íˆ H100 í•˜ë‚˜ë‹¹ 25,000-40,000ë‹¬ëŸ¬ì˜ ë†’ì€ ê°€ê²©ê³¼ 90% ì´ìƒì˜ ì´ˆê³ ìˆ˜ìµ ë§ˆì§„ êµ¬ì¡°ë¥¼ ê³ ë ¤í•  ë•Œ, ì—”ë¹„ë””ì•„ëŠ” í–¥í›„ 2-3ë…„ê°„ ì—­ì‚¬ìƒ ìœ ë¡€ì—†ëŠ” ìˆ˜ìµì„±ì„ ê¸°ë¡í•  ê²ƒìœ¼ë¡œ ì „ë§ë¨`;
        }
      } else if (sentimentType === 'negative') {
        if (currentReasoning.includes('ì¤‘êµ­')) {
          return `ë¯¸êµ­ ì •ë¶€ì˜ ì¤‘êµ­í–¥ AI ì¹© ìˆ˜ì¶œ ì œì¬ ê°•í™”ë¡œ ì—”ë¹„ë””ì•„ê°€ ì „ì²´ ë§¤ì¶œì˜ 20-25%ë¥¼ ì°¨ì§€í•˜ëŠ” ì¤‘êµ­ ì‹œì¥ì—ì„œ ì™„ì „íˆ ì°¨ë‹¨ë˜ë©´ì„œ ë‹¨ê¸°ì ìœ¼ë¡œ 50ì–µ-70ì–µë‹¬ëŸ¬ì˜ ë§¤ì¶œ ì†ì‹¤ì´ ë¶ˆê°€í”¼í•œ ìƒí™©ì„. ë˜í•œ ì¤‘êµ­ ì •ë¶€ê°€ ë°”ì´ë‘, ì•Œë¦¬ë°”ë°” ë“± ìêµ­ AI ê¸°ì—…ë“¤ì—ê²Œ ì—”ë¹„ë””ì•„ GPU ëŒ€ì‹  í™”ì›¨ì´ Ascend ì‹œë¦¬ì¦ˆë‚˜ ìì²´ ê°œë°œ AI ì¹© ì‚¬ìš©ì„ ê°•ë ¥íˆ ê¶Œê³ í•˜ê³  ìˆì–´, ì œì¬ í•´ì œ ì´í›„ì—ë„ ì¤‘êµ­ ì‹œì¥ íšŒë³µì´ ì–´ë ¤ìš¸ ê²ƒìœ¼ë¡œ ì˜ˆìƒë¨. ì´ëŠ” ì¥ê¸°ì ìœ¼ë¡œ ì—”ë¹„ë””ì•„ì˜ ê¸€ë¡œë²Œ ì‹œì¥ ì§€ë°°ë ¥ ì•½í™”ì™€ í•¨ê»˜ ì¤‘êµ­ ë‚´ AI ì¹© ìƒíƒœê³„ê°€ ë¯¸êµ­ ê¸°ìˆ ê³¼ ì™„ì „íˆ ë¶„ë¦¬ë˜ëŠ” ë””ì»¤í”Œë§ í˜„ìƒì„ ê°€ì†í™”ì‹œí‚¬ ìš°ë ¤ê°€ ìˆìŒ`;
        }
      }
    }
    
    else if (ticker === 'AAPL') { // ì• í”Œ
      if (sentimentType === 'positive') {
        if (currentReasoning.includes('ì•„ì´í°')) {
          return `ì•„ì´í° 15 Pro ì‹œë¦¬ì¦ˆì˜ í‹°íƒ€ëŠ„ ì†Œì¬ ë„ì…ê³¼ USB-C ì „í™˜, A17 Pro ì¹©ì…‹ì˜ 3ë‚˜ë…¸ ê³µì • ì ìš©ìœ¼ë¡œ í”„ë¦¬ë¯¸ì—„ ìŠ¤ë§ˆíŠ¸í° ì‹œì¥ì—ì„œ ì• í”Œì˜ ê¸°ìˆ ì  ìš°ìœ„ì™€ ë¸Œëœë“œ íŒŒì›Œê°€ ë”ìš± ê°•í™”ë˜ê³  ìˆìŒ. íŠ¹íˆ ì¸ë„, ë™ë‚¨ì•„ì‹œì•„ ë“± ì‹ í¥ ì‹œì¥ì—ì„œ ì¤‘ì‚°ì¸µ í™•ëŒ€ì™€ í•¨ê»˜ ì•„ì´í°ì— ëŒ€í•œ ìˆ˜ìš”ê°€ ê¸‰ì¦í•˜ê³  ìˆìœ¼ë©°, ì• í”Œì˜ trade-in í”„ë¡œê·¸ë¨ê³¼ í• ë¶€ ê¸ˆìœµ ì„œë¹„ìŠ¤ í™•ëŒ€ë¡œ ì ‘ê·¼ì„±ë„ í¬ê²Œ ê°œì„ ë˜ì—ˆìŒ. ì•„ì´í°ì€ ì• í”Œ ì „ì²´ ë§¤ì¶œì˜ 50% ì´ìƒì„ ì°¨ì§€í•˜ëŠ” í•µì‹¬ ì‚¬ì—…ìœ¼ë¡œ, ì•ˆì •ì ì¸ íŒë§¤ ì„±ì¥ê³¼ í•¨ê»˜ ì•±ìŠ¤í† ì–´, ì•„ì´í´ë¼ìš°ë“œ ë“± ì„œë¹„ìŠ¤ ìƒíƒœê³„ í™•ì¥ì˜ ê¸°ë°˜ ì—­í• ì„ í•˜ì—¬ ì• í”Œì˜ ì¥ê¸°ì  ì„±ì¥ ë™ë ¥ì„ ì œê³µí•˜ê³  ìˆìŒ`;
        } else if (currentReasoning.includes('ì„œë¹„ìŠ¤')) {
          return `ì• í”Œì˜ ì„œë¹„ìŠ¤ ì‚¬ì—…ì´ ë¶„ê¸° ë§¤ì¶œ 200ì–µë‹¬ëŸ¬ë¥¼ ëŒíŒŒí•˜ë©° ì „ì²´ ë§¤ì¶œì˜ 25%ê¹Œì§€ í™•ëŒ€ë˜ë©´ì„œ í•˜ë“œì›¨ì–´ ì¤‘ì‹¬ì—ì„œ ì†Œí”„íŠ¸ì›¨ì–´ ì¤‘ì‹¬ì˜ ìˆ˜ìµ êµ¬ì¡°ë¡œ ì „í™˜ì´ ê°€ì†í™”ë˜ê³  ìˆìŒ. ì•±ìŠ¤í† ì–´ 30% ìˆ˜ìˆ˜ë£Œ, ì•„ì´í´ë¼ìš°ë“œ êµ¬ë…ë£Œ, ì• í”Œë®¤ì§, ì• í”ŒTV+ ë“± êµ¬ë… ì„œë¹„ìŠ¤ë“¤ì´ ì•ˆì •ì ì¸ ê²½ìƒ ìˆ˜ìµì„ ì°½ì¶œí•˜ë©° ê³„ì ˆì  ë³€ë™ì„±ì´ í° í•˜ë“œì›¨ì–´ ë§¤ì¶œì„ ë³´ì™„í•˜ê³  ìˆìŒ. íŠ¹íˆ ì„œë¹„ìŠ¤ ì‚¬ì—…ì˜ 70% ì´ìƒ ë§ˆì§„ìœ¨ì€ í•˜ë“œì›¨ì–´ ì‚¬ì—… ëŒ€ë¹„ 2-3ë°° ë†’ì•„ ì• í”Œì˜ ì „ì²´ ìˆ˜ìµì„± ê°œì„ ì— í•µì‹¬ ì—­í• ì„ í•˜ê³  ìˆìœ¼ë©°, ì „ ì„¸ê³„ 20ì–µê°œ ì´ìƒì˜ í™œì„± ì• í”Œ ê¸°ê¸°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ê±°ëŒ€í•œ ì‚¬ìš©ì ë² ì´ìŠ¤ëŠ” ì§€ì†ì ì¸ ì„œë¹„ìŠ¤ í™•ì¥ì˜ ê°•ë ¥í•œ ê¸°ë°˜ì´ ë˜ê³  ìˆìŒ`;
        }
      } else if (sentimentType === 'negative') {
        if (currentReasoning.includes('ì¤‘êµ­')) {
          return `ì¤‘êµ­ ì •ë¶€ê°€ ê³µë¬´ì›ê³¼ êµ­ìœ ê¸°ì—… ì§ì›ë“¤ì˜ ì•„ì´í° ì‚¬ìš©ì„ ê¸ˆì§€í•˜ê³  í™”ì›¨ì´ ë©”ì´íŠ¸60 ë“± ìêµ­ ë¸Œëœë“œ ì‚¬ìš©ì„ ê¶Œì¥í•˜ë©´ì„œ ì• í”Œì˜ ì¤‘êµ­ ì‹œì¥ ì…ì§€ê°€ ê¸‰ê²©íˆ ì•½í™”ë˜ê³  ìˆìŒ. ì¤‘êµ­ì€ ì• í”Œ ì „ì²´ ë§¤ì¶œì˜ 15-20%ë¥¼ ì°¨ì§€í•˜ëŠ” í•µì‹¬ ì‹œì¥ìœ¼ë¡œ, 2024ë…„ 1ë¶„ê¸° ì¤‘êµ­ ë‚´ ì•„ì´í° íŒë§¤ëŸ‰ì´ ì „ë…„ ë™ê¸° ëŒ€ë¹„ 24% ê¸‰ê°í•œ ê²ƒì€ ì‹¬ê°í•œ ê²½ê³  ì‹ í˜¸ì„. ë˜í•œ ì¤‘êµ­ ì†Œë¹„ìë“¤ ì‚¬ì´ì—ì„œë„ ë°˜ë¯¸ ê°ì •ê³¼ ì• êµ­ì£¼ì˜ í™•ì‚°ìœ¼ë¡œ í™”ì›¨ì´, ìƒ¤ì˜¤ë¯¸ ë“± ì¤‘êµ­ ë¸Œëœë“œ ì„ í˜¸ë„ê°€ ë†’ì•„ì§€ê³  ìˆì–´, ì• í”Œì´ í–¥í›„ ìˆ˜ë…„ê°„ ì¤‘êµ­ ì‹œì¥ì—ì„œ ì§€ì†ì ì¸ ì ìœ ìœ¨ í•˜ë½ê³¼ ë§¤ì¶œ ê°ì†Œë¥¼ ê²ªì„ ê°€ëŠ¥ì„±ì´ ë†’ìŒ`;
        }
      }
    }
    
    // ê¸°ë³¸ì ìœ¼ë¡œ í˜„ì¬ ê·¼ê±°ì˜ ë‘ ë°° ê¸¸ì´ë¡œ í™•ì¥
    return currentReasoning + `. ì´ëŸ¬í•œ ìƒí™©ì€ í•´ë‹¹ ê¸°ì—…ì˜ ì¤‘ì¥ê¸°ì  ì‚¬ì—… ì „ëµê³¼ ì‹œì¥ í¬ì§€ì…”ë‹ì— ì¤‘ìš”í•œ ì˜í–¥ì„ ë¯¸ì¹˜ë©°, íˆ¬ììë“¤ì€ ê´€ë ¨ ë¦¬ìŠ¤í¬ì™€ ê¸°íšŒ ìš”ì†Œë“¤ì„ ì¢…í•©ì ìœ¼ë¡œ ê³ ë ¤í•˜ì—¬ íˆ¬ì ê²°ì •ì„ ë‚´ë ¤ì•¼ í•  ê²ƒìœ¼ë¡œ íŒë‹¨ë¨`;
  }

  enhanceExistingReasoning(ticker, sentimentType, currentReasoning) {
    // ì´ë¯¸ ì¶©ë¶„íˆ ê¸´ ê·¼ê±°ì— ì¶”ê°€ì ì¸ êµ¬ì²´ì  ë‚´ìš© ë³´ê°•
    let additionalContext = '';
    
    if (ticker === '005930') {
      additionalContext = `. ì‚¼ì„±ì „ìëŠ” ê¸€ë¡œë²Œ ë©”ëª¨ë¦¬ ë°˜ë„ì²´ ì‹œì¥ ì ìœ ìœ¨ 43%ë¥¼ ì°¨ì§€í•˜ëŠ” ì ˆëŒ€ ê°•ìë¡œì„œ, í–¥í›„ AI ë°˜ë„ì²´ ìŠˆí¼ì‚¬ì´í´ì˜ í•µì‹¬ ìˆ˜í˜œì£¼ ì—­í• ì„ í•  ê²ƒìœ¼ë¡œ ì˜ˆìƒë˜ë©°, íŠ¹íˆ HBM ë¶„ì•¼ì—ì„œëŠ” SKí•˜ì´ë‹‰ìŠ¤ì™€ í•¨ê»˜ ì‚¬ì‹¤ìƒ ë…ì  êµ¬ì¡°ë¥¼ í˜•ì„±í•˜ê³  ìˆì–´ ë†’ì€ ìˆ˜ìµì„±ê³¼ ì„±ì¥ì„±ì„ ë™ì‹œì— í™•ë³´í•  ìˆ˜ ìˆëŠ” ìœ ë¦¬í•œ ìœ„ì¹˜ì— ìˆìŒ`;
    } else if (ticker === 'TSLA') {
      additionalContext = `. í…ŒìŠ¬ë¼ëŠ” ì „ê¸°ì°¨ ì‹œì¥ì˜ ì„ ë„ì—…ì²´ë¡œì„œ ì—°ê°„ 200ë§ŒëŒ€ ìƒì‚° ëª©í‘œ ë‹¬ì„±ê³¼ í•¨ê»˜ ë¡œë´‡íƒì‹œ, ì—ë„ˆì§€ ì €ì¥ ì‹œìŠ¤í…œ, íƒœì–‘ê´‘ íŒ¨ë„ ë“± ë‹¤ê°í™”ëœ ì‚¬ì—… í¬íŠ¸í´ë¦¬ì˜¤ë¥¼ í†µí•´ ë‹¨ìˆœí•œ ìë™ì°¨ íšŒì‚¬ì—ì„œ ì¢…í•© ì—ë„ˆì§€ ê¸°ì—…ìœ¼ë¡œì˜ ì „í™˜ì„ ì¶”ì§„í•˜ê³  ìˆì–´ ì¥ê¸°ì  ì„±ì¥ ê°€ëŠ¥ì„±ì´ ë§¤ìš° ë†’ìŒ`;
    } else if (ticker === 'NVDA') {
      additionalContext = `. ì—”ë¹„ë””ì•„ëŠ” AI ì¹© ì‹œì¥ì—ì„œ 80% ì´ìƒì˜ ì••ë„ì  ì ìœ ìœ¨ì„ ë°”íƒ•ìœ¼ë¡œ CUDA ì†Œí”„íŠ¸ì›¨ì–´ ìƒíƒœê³„ì™€ ê²°í•©ëœ ê°•ë ¥í•œ ê²½ìŸ ìš°ìœ„ë¥¼ êµ¬ì¶•í•˜ê³  ìˆìœ¼ë©°, ì´ëŠ” ë‹¨ìˆœí•œ í•˜ë“œì›¨ì–´ ê²½ìŸì„ ë„˜ì–´ì„  í”Œë«í¼ ì°¨ì›ì˜ ë…ì ë ¥ìœ¼ë¡œ ì‘ìš©í•˜ì—¬ ê²½ìŸì‚¬ë“¤ì˜ ì¶”ê²©ì„ íš¨ê³¼ì ìœ¼ë¡œ ì°¨ë‹¨í•˜ê³  ìˆìŒ`;
    } else if (ticker === 'AAPL') {
      additionalContext = `. ì• í”Œì€ ì „ ì„¸ê³„ 20ì–µê°œ ì´ìƒì˜ í™œì„± ê¸°ê¸°ë¥¼ ë³´ìœ í•œ ê±°ëŒ€í•œ ìƒíƒœê³„ë¥¼ ë°”íƒ•ìœ¼ë¡œ í•˜ë“œì›¨ì–´-ì†Œí”„íŠ¸ì›¨ì–´-ì„œë¹„ìŠ¤ê°€ ì™„ë²½íˆ í†µí•©ëœ ë…íŠ¹í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ëª¨ë¸ì„ êµ¬ì¶•í•˜ê³  ìˆìœ¼ë©°, ì´ëŠ” ê³ ê° ì¶©ì„±ë„ì™€ ì „í™˜ ë¹„ìš© ì¥ë²½ì„ ë†’ì—¬ ì§€ì†ì ì¸ í”„ë¦¬ë¯¸ì—„ ê°€ê²© ì •ì±…ê³¼ ì•ˆì •ì  ìˆ˜ìµ ì°½ì¶œì„ ê°€ëŠ¥í•˜ê²Œ í•˜ê³  ìˆìŒ`;
    }
    
    return currentReasoning + additionalContext;
  }

  async updateSentimentReasoning(postId, ticker, newReasoning) {
    return new Promise((resolve, reject) => {
      this.db.run(`
        UPDATE sentiments 
        SET key_reasoning = ?
        WHERE post_id = ? AND ticker = ?
      `, [newReasoning, postId, ticker], function(err) {
        if (err) reject(err);
        else resolve(this.changes);
      });
    });
  }
}

const expander = new DetailedSentimentExpander();
expander.expandAllSentimentReasoning().catch(console.error);