const sqlite3 = require('sqlite3').verbose();
const path = require('path');

// ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°
const db = new sqlite3.Database(path.join(__dirname, '../database.db'));

// 100ì ì´ë‚´ë¡œ ìˆ˜ì •ëœ íšŒì‚¬ ì„¤ëª…
const trimmedDescriptions = {
  // í˜„ì¬ 100ì ì´ˆê³¼ì¸ ì¢…ëª©ë“¤ì„ 100ì ì´ë‚´ë¡œ ìˆ˜ì •
  '005930': 'ì„¸ê³„ ìµœëŒ€ ë©”ëª¨ë¦¬ ë°˜ë„ì²´ ì œì¡°ì‚¬ì´ì ê°¤ëŸ­ì‹œ ìŠ¤ë§ˆíŠ¸í°ìœ¼ë¡œ ê¸€ë¡œë²Œ ëª¨ë°”ì¼ ì‹œì¥ì„ ì„ ë„í•˜ëŠ” ì‚¼ì„±ê·¸ë£¹ì˜ í•µì‹¬ ê³„ì—´ì‚¬. HBM ë©”ëª¨ë¦¬ì™€ AI ë°˜ë„ì²´ ìƒíƒœê³„ ì£¼ë„', // 99ì
  
  'TSLA': 'ì¼ë¡  ë¨¸ìŠ¤í¬ê°€ CEOë¡œ ì´ë„ëŠ” ì „ê¸°ì°¨ í˜ì‹  ê¸°ì—…ìœ¼ë¡œ Model S/3/X/Yì™€ Cybertruck ì œì¡°. FSD ììœ¨ì£¼í–‰ê³¼ ì—ë„ˆì§€ ì €ì¥ ì‹œìŠ¤í…œìœ¼ë¡œ ì§€ì†ê°€ëŠ¥ ìƒíƒœê³„ êµ¬ì¶•', // 99ì
  
  'NVDA': 'ChatGPT ë“± ìƒì„±í˜• AI í˜ëª…ì˜ í•µì‹¬ ì¸í”„ë¼ì¸ H100, A100 AI ì¹©ì„ ë…ì  ê³µê¸‰í•˜ëŠ” GPU ì ˆëŒ€ê°•ì. ë°ì´í„°ì„¼í„°ì™€ ììœ¨ì£¼í–‰ ì „ ë¶„ì•¼ì—ì„œ AI ì»´í“¨íŒ… í”Œë«í¼ ì§€ë°°', // 100ì
  
  '000660': 'ì„¸ê³„ 2ìœ„ ë©”ëª¨ë¦¬ ë°˜ë„ì²´ ì œì¡°ì‚¬ë¡œ DRAMê³¼ NAND í”Œë˜ì‹œë¥¼ ì£¼ë ¥ ìƒì‚°. AI ë°ì´í„°ì„¼í„° í•µì‹¬ ë¶€í’ˆì¸ HBM ë©”ëª¨ë¦¬ë¡œ ì‚¼ì„±ì „ìì™€ ê¸€ë¡œë²Œ ë…ì  ì²´ì œ êµ¬ì¶•', // 95ì
  
  'AMD': 'ì¸í…”ì˜ ìµœëŒ€ ê²½ìŸì‚¬ë¡œ ê³ ì„±ëŠ¥ CPU Ryzenê³¼ GPU Radeon ì œì¡°. ìµœê·¼ AI ë¶„ì•¼ ê¸‰ì„±ì¥í•˜ë©° ë°ì´í„°ì„¼í„°ìš© EPYCì™€ AI ê°€ì†ê¸°ë¡œ ë°˜ë„ì²´ ì‹œì¥ ë„ì „', // 96ì
  
  'AMZN': 'ì„¸ê³„ ìµœëŒ€ ì „ììƒê±°ë˜ í”Œë«í¼ì´ì AWS í´ë¼ìš°ë“œë¡œ ì „ ì„¸ê³„ ì¸í„°ë„· ì¸í”„ë¼ì˜ 30%ë¥¼ ë‹´ë‹¹. í”„ë¼ì„ ë©¤ë²„ì‹­ê³¼ ì•Œë ‰ì‚¬ë¡œ ì†Œë¹„ì ê²½í—˜ í˜ì‹ í•˜ëŠ” í´ë¼ìš°ë“œ ê³µë£¡', // 99ì
  
  'UNH': 'ë¯¸êµ­ ìµœëŒ€ ê±´ê°•ë³´í—˜íšŒì‚¬ì´ì ì˜ë£Œì„œë¹„ìŠ¤ í†µí•© ì œê³µì—…ì²´ë¡œ 5000ë§Œëª… ì´ìƒì—ê²Œ ì„œë¹„ìŠ¤ ì œê³µ. Optum í”Œë«í¼ìœ¼ë¡œ ë””ì§€í„¸ í—¬ìŠ¤ì¼€ì–´ ìƒíƒœê³„ êµ¬ì¶•í•˜ëŠ” ì„ ë„ê¸°ì—…', // 98ì
  
  'GOOGL': 'êµ¬ê¸€ ê²€ìƒ‰ì—”ì§„ìœ¼ë¡œ ì¸í„°ë„· ìƒíƒœê³„ë¥¼ ì¥ì•…í•˜ê³  ìœ íŠœë¸Œ, ì•ˆë“œë¡œì´ë“œ OS, êµ¬ê¸€ í´ë¼ìš°ë“œë¥¼ í†µí•´ ë””ì§€í„¸ ì¸í”„ë¼ ì œê³µ. AI ê¸°ìˆ  Bardì™€ Geminië¡œ ì°¨ì„¸ëŒ€ ê²½ìŸ ì„ ë„', // 100ì
  
  'INTC': 'ë°˜ë„ì²´ ì‚°ì—… 50ë…„ ì„ êµ¬ìë¡œ x86 CPU ì•„í‚¤í…ì²˜ ê°œë°œí•´ PC í˜ëª… ì£¼ë„. ë°ì´í„°ì„¼í„°ìš© Xeon í”„ë¡œì„¸ì„œì™€ AI ì¹© Gaudi, íŒŒìš´ë“œë¦¬ ì‚¬ì—…ìœ¼ë¡œ ì¬ë„ì•½ ì¶”ì§„', // 97ì
  
  'LLY': '1876ë…„ ì°½ë¦½ëœ ê¸€ë¡œë²Œ ì œì•½ ëŒ€ê¸°ì—…ìœ¼ë¡œ ë‹¹ë‡¨ë³‘ ì¹˜ë£Œì œ ì¸ìŠë¦°ì„ ìµœì´ˆ ìƒìš©í™”. ìµœê·¼ ë¹„ë§Œì¹˜ë£Œì œ Mounjaroì™€ ì•Œì¸ í•˜ì´ë¨¸ ì¹˜ë£Œì œë¡œ ì œì•½ì—…ê³„ í˜ì‹  ì£¼ë„', // 95ì
  
  'ASML': 'ë°˜ë„ì²´ ì œì¡° í•µì‹¬ ì¥ë¹„ì¸ ê·¹ìì™¸ì„  ë…¸ê´‘ì¥ë¹„ë¥¼ ì „ ì„¸ê³„ì—ì„œ ìœ ì¼í•˜ê²Œ ìƒì‚°í•˜ëŠ” ë„¤ëœë€ë“œ ê¸°ì—…. ì‚¼ì„±, TSMC, ì¸í…” ë“± ëª¨ë“  ë°˜ë„ì²´ ì œì¡°ì‚¬ê°€ ì˜ì¡´í•˜ëŠ” í•„ìˆ˜ ê¸°ì—…', // 100ì
  
  '373220': 'LGí™”í•™ì—ì„œ ë¶„ì‚¬í•œ ì„¸ê³„ 2ìœ„ ë°°í„°ë¦¬ ì œì¡°ì‚¬ë¡œ í…ŒìŠ¬ë¼, GM, ë³¼ë³´ ë“± ê¸€ë¡œë²Œ ì™„ì„±ì°¨ ì—…ì²´ì— ì „ê¸°ì°¨ìš© ë¦¬íŠ¬ì´ì˜¨ ë°°í„°ë¦¬ ê³µê¸‰. ESSì™€ ì†Œí˜• ë°°í„°ë¦¬ê¹Œì§€ ìƒíƒœê³„ ì™„ì„±', // 100ì
  
  'AAPL': 'ì•„ì´í°ìœ¼ë¡œ ìŠ¤ë§ˆíŠ¸í° í˜ëª…ì„ ì´ëŒê³  iOS ìƒíƒœê³„, ì•±ìŠ¤í† ì–´, ì• í”Œ ì‹¤ë¦¬ì½˜ìœ¼ë¡œ í•˜ë“œì›¨ì–´ì™€ ì†Œí”„íŠ¸ì›¨ì–´ í†µí•©. ì—°ë§¤ì¶œ 400ì¡°ì›, ì‹œê°€ì´ì•¡ 3ì¡°ë‹¬ëŸ¬ì˜ ì„¸ê³„ ìµœëŒ€ ê¸°ìˆ ê¸°ì—…', // 100ì
  
  '035420': 'êµ­ë‚´ ìµœëŒ€ í¬í„¸ì‚¬ì´íŠ¸ ë„¤ì´ë²„ë¥¼ ìš´ì˜í•˜ë©° ì›¹íˆ°, í´ë¡œë°” AI, ë„¤ì´ë²„ í´ë¼ìš°ë“œë¡œ ë””ì§€í„¸ ì½˜í…ì¸ ì™€ B2B ì„œë¹„ìŠ¤ í™•ì¥. ë¼ì¸ê³¼ í•¨ê»˜ ì•„ì‹œì•„ ë””ì§€í„¸ í”Œë«í¼ ìƒíƒœê³„ êµ¬ì¶•', // 100ì
  
  '042660': 'LNGì„ ê³¼ í•´ì–‘í”ŒëœíŠ¸ ê±´ì¡° ì „ë¬¸ ì¡°ì„ ê¸°ì—…ìœ¼ë¡œ ì¹œí™˜ê²½ ì„ ë°• ê¸°ìˆ  ë³´ìœ í•œ í•œí™”ê·¸ë£¹ ê³„ì—´ì‚¬. í•´ìƒí’ë ¥ ë°œì „ì„¤ë¹„ì™€ ìˆ˜ì†Œ ì¶”ì§„ ì„ ë°•ìœ¼ë¡œ ê·¸ë¦° ì—ë„ˆì§€ í•´ì–‘ ì†”ë£¨ì…˜ ì„ ë„', // 99ì
  
  '006400': 'ì‚¼ì„±ê·¸ë£¹ ê³„ì—´ì˜ ë°°í„°ë¦¬ ì†Œì¬ì™€ ë°˜ë„ì²´ ì†Œì¬ ì „ë¬¸ê¸°ì—…ìœ¼ë¡œ ì „ê¸°ì°¨ ë°°í„°ë¦¬ìš© ì–‘ê·¹ì¬ì™€ ë°˜ë„ì²´ ê³µì •ìš© íŠ¹ìˆ˜ ì†Œì¬ ìƒì‚°. ì°¨ì„¸ëŒ€ ì „ê³ ì²´ ë°°í„°ë¦¬ì™€ ì²¨ë‹¨ ë°˜ë„ì²´ ì†Œì¬ ê°œë°œ', // 100ì
  
  'JPM': 'ë¯¸êµ­ ìµœëŒ€ íˆ¬ìì€í–‰ì´ì ìƒì—…ì€í–‰ìœ¼ë¡œ ìì‚°ê·œëª¨ 4ì¡°ë‹¬ëŸ¬ ë³´ìœ í•œ ì›”ìŠ¤íŠ¸ë¦¬íŠ¸ ê¸ˆìœµ ê³µë£¡. íˆ¬ìì€í–‰ì—…ë¬´, ìì‚°ê´€ë¦¬, ê°œì¸ê¸ˆìœµ, ìƒì—…ê¸ˆìœµ ì•„ìš°ë¥´ë©° ê¸€ë¡œë²Œ ê¸ˆìœµì‹œì¥ ë…ë³´ì  ì˜í–¥ë ¥', // 100ì
  
  '035720': 'ì¹´ì¹´ì˜¤í†¡ ë©”ì‹ ì €ë¡œ êµ­ë‚´ ëª¨ë°”ì¼ ìƒí™œ ì¸í”„ë¼ë¥¼ ì¥ì•…í•˜ê³  ì¹´ì¹´ì˜¤í˜ì´, ì¹´ì¹´ì˜¤íƒì‹œ, ì¹´ì¹´ì˜¤ë±…í¬ë¡œ í•€í…Œí¬ì™€ O2O ì„œë¹„ìŠ¤ í†µí•© ì œê³µ. ë””ì§€í„¸ í”Œë«í¼ ìƒí™œë°€ì°©í˜• ìƒíƒœê³„ ì™„ì„±', // 100ì
  
  'TSM': 'ì• í”Œ ì•„ì´í° Aì‹œë¦¬ì¦ˆ ì¹©ê³¼ ì—”ë¹„ë””ì•„ GPUë¥¼ ìœ„íƒìƒì‚°í•˜ëŠ” ì„¸ê³„ 1ìœ„ íŒŒìš´ë“œë¦¬ ê¸°ì—…. ì²¨ë‹¨ 3ë‚˜ë…¸ ê³µì • ê¸°ìˆ ë¡œ ê¸€ë¡œë²Œ ë°˜ë„ì²´ ìƒì‚°ì˜ 50% ì´ìƒ ë‹´ë‹¹í•˜ë©° ëŒ€ë§Œ ê²½ì œ í•µì‹¬', // 100ì
};

console.log('ğŸ”„ íšŒì‚¬ ì„¤ëª…ì„ 100ì ì´ë‚´ë¡œ ìˆ˜ì • ì‹œì‘...');
console.log(`ğŸ“Š ì´ ${Object.keys(trimmedDescriptions).length}ê°œ ì¢…ëª© ìˆ˜ì • ì˜ˆì •\n`);

// ê° íšŒì‚¬ ì„¤ëª…ì„ ì—…ë°ì´íŠ¸
const updatePromises = Object.entries(trimmedDescriptions).map(([ticker, description]) => {
  return new Promise((resolve, reject) => {
    db.run(
      'UPDATE stocks SET description = ? WHERE ticker = ?',
      [description, ticker],
      function(err) {
        if (err) {
          console.error(`âŒ ${ticker} ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:`, err);
          reject(err);
        } else {
          if (this.changes > 0) {
            console.log(`âœ… ${ticker}: "${description.substring(0, 40)}..." (${description.length}ì)`);
          } else {
            console.log(`âš ï¸ ${ticker}: í•´ë‹¹ ì¢…ëª©ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤`);
          }
          resolve();
        }
      }
    );
  });
});

// ëª¨ë“  ì—…ë°ì´íŠ¸ ì™„ë£Œ í›„ í™•ì¸
Promise.all(updatePromises)
  .then(() => {
    console.log('\nğŸ¯ ì—…ë°ì´íŠ¸ ì™„ë£Œ! ì „ì²´ ì¢…ëª©ì˜ ê¸€ì ìˆ˜ í™•ì¸:');
    db.all(
      'SELECT ticker, company_name, description, LENGTH(description) as len FROM stocks WHERE description IS NOT NULL AND description != "" ORDER BY len DESC LIMIT 30',
      (err, rows) => {
        if (err) {
          console.error('âŒ í™•ì¸ ì¿¼ë¦¬ ì‹¤íŒ¨:', err);
        } else {
          console.log('\nğŸ“‹ ìƒìœ„ 30ê°œ ì¢…ëª© ê¸€ì ìˆ˜:');
          rows.forEach((row, index) => {
            const length = row.len || 0;
            const status = length > 100 ? 'âŒ' : 'âœ…';
            const preview = row.description ? row.description.substring(0, 50) + '...' : 'N/A';
            console.log(`${status} ${index + 1}. ${row.ticker} (${row.company_name}): ${length}ì`);
            if (length > 100) {
              console.log(`   "${preview}"`);
            }
          });
          
          const over100 = rows.filter(row => row.len > 100);
          if (over100.length > 0) {
            console.log(`\nâŒ 100ì ì´ˆê³¼ ì¢…ëª© (${over100.length}ê°œ):`);
            over100.forEach(row => {
              console.log(`${row.ticker}: ${row.len}ì - "${row.description.substring(0, 60)}..."`);
            });
          } else {
            console.log('\nâœ… ëª¨ë“  ì¢…ëª©ì´ 100ì ì´ë‚´ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
          }
          
          const avgLength = rows.reduce((sum, row) => sum + (row.len || 0), 0) / rows.length;
          console.log(`\nğŸ“Š í‰ê·  ì„¤ëª… ê¸¸ì´: ${Math.round(avgLength)}ì`);
        }
        
        db.close((err) => {
          if (err) {
            console.error('âŒ DB ì—°ê²° ì¢…ë£Œ ì‹¤íŒ¨:', err);
          } else {
            console.log('\nâœ… ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì¢…ë£Œ');
          }
        });
      }
    );
  })
  .catch((error) => {
    console.error('âŒ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
    db.close();
  });